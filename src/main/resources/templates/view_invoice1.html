<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Invoice Management System</title>

<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
</head>
<body>
	<div class="container">
		<nav class="navbar navbar-inverse navbar-fixed-top" style="background-color: #41a4bf;">
			<div class="container">
				<img src="../static/img/payment.png" width="40" height="40"/>
				<a class="navbar-brand" href="#" style="color:white;">Invoice Management System </a>
				<a class="navbar-brand" style="margin-left: 600px;color:white;" href="#" th:href="@{/logout}">Logout </a>

			</div>
		</nav>
		<h1>Invoice Management System</h1>
		<hr>
		<form action="#"  th:object="${invoice}">
		<h2>Invoice:</h2><h2 th:value="*{title}"></h2>


			<!-- Add hidden form field to handle update -->
			<input type="hidden" th:field="*{id}" />

		<input type="text" th:field="*{title}" class="form-control mb-4 col-4"  disabled='disabled'>

		<input type="text" th:field="*{description}" class="form-control mb-4 col-4"  disabled='disabled'>

		<input type="date" th:field="*{creationDate}" class="form-control mb-4 col-4"  disabled='disabled'>

		<input type="number" th:field="*{total}" class="form-control mb-4 col-4"  disabled='disabled'>
<!--			<button type="submit" class="btn btn-info col-2"> Update Invoice</button>-->
		</form>

		<h4>Upload Multiple Files:</h4>
		<form method="POST" enctype="multipart/form-data" th:action="@{/upload-multiple-files/id/{idInvoice}(idInvoice=${invoice.id})}">
			<input type="file" name="files" multiple> <br/><br/>
			<button class="btn" style="color:white;background-color: limegreen" type="submit">Add attachment to invoice</button>
<!--			<a th:href="@{/upload-multiple-files/id/{idInvoice}(idInvoice=${invoice.id})}" class="btn" style="color:white;background-color: limegreen">Add attachment to invoice</a>-->

		</form>


		<h2>All Uploaded Files:</h2>
		<ul>
			<li th:each="file : ${files}">
				<a th:href="${file.uri}" target="_blank" th:text="${file.uri}"></a>
			</li>
		</ul>

		<hr>
		
		<a th:href = "@{/listInvoice}"> Back to Invoice List</a>
	</div>
	<div class="container my-2">
		<hr>
		<h2>Invoice Items list</h2>
		<table border="1" class = "table table-striped table-responsive-md">
			<thead>
			<tr>
				<th>
					<a th:href="@{'/page/' + ${currentPage} + '?sortField=id&sortDir=' + ${reverseSortDir}}">
						Name</a>
				</th>
				<th>
					<a th:href="@{'/page/' + ${currentPage} + '?sortField=id&sortDir=' + ${reverseSortDir}}">
						Price</a>
				</th>
				<th>
					<a th:href="@{'/page/' + ${currentPage} + '?sortField=description&sortDir=' + ${reverseSortDir}}">
						quantity</a>
				</th>
				<th>
					<a th:href="@{'/page/' + ${currentPage} + '?sortField=discount&sortDir=' + ${reverseSortDir}}">
						discount</a>
				</th>
				<th>
					<a th:href="@{'/page/' + ${currentPage} + '?sortField=priceafterdiscount&sortDir=' + ${reverseSortDir}}">
						Price After Discount</a>
				</th>

				<th> Actions </th>
			</tr>
			</thead>
			<tbody>
			<tr th:each="invoiceitem : ${invoiceItemList}">
				<td th:text="${invoiceitem.item.name}"></td>
				<td th:text="${invoiceitem.item.price}"></td>
				<td><input type="number" name="quantity" th:value="${invoiceitem.quantity}" placeholder="quantity" class="form-control mb-4 col-4" th:contenteditable="true"></td>
				<td><input type="number" name="discount" th:value="${invoiceitem.discount}" placeholder="discount" class="form-control mb-4 col-4" th:contenteditable="true"></td>

<!--				<td th:text="${invoiceitem.quantity}" contenteditable></td>-->
<!--				<td th:text="${invoiceitem.discount}" contenteditable></td>-->
				<td th:text="${invoiceitem.priceafterdiscount}"></td>


				<!--				<td th:text="${invoiceItem.total}"></td>-->
				<td>
<!--					<a th:href="@{/showFormForUpdateInvoice/{id}(id=${invoice.id})}" class="btn btn-primary">Update</a>-->
					<a th:href="@{/deleteItemFromInvoivce/invoiceId/{idInvoice}/InvoiceitemId/{idInvoiceitem}(idInvoice=${invoice.id},idInvoiceitem=${invoiceitem.id})}" class="btn btn-danger">
						Delete</a>
					<a th:href="@{/updateItemFromInvoivce/invoiceId/{idInvoice}/idInvoiceitem/{idInvoiceitem}/q/{q}/d/{d}(idInvoice=${invoice.id},idInvoiceitem=${invoiceitem.id},q=${invoiceitem.quantity},d=${invoiceitem.discount})}" class="btn btn-info">
						Update</a>
				</td>
				<!--					<a th:href="@{/viewInvoice/{id}(id=${invoice.id})}" class="btn" style="color:white;background-color: limegreen">View</a>-->


			</tr>
			</tbody>
		</table>


		<hr>
		<h2>Items list</h2>

		<form action="#" th:action="@{/saveItem/{idInvoice}(idInvoice=${invoice.id})}" th:object="${newInvoiceItem}" method="POST">
			<input type="text" th:field="*{item.name}" placeholder="name" class="form-control mb-4 col-4">
			<input type="text" th:field="*{item.price}" placeholder="price" class="form-control mb-4 col-4">
			<input type="number" th:field="*{quantity}" value="1" placeholder="quantity" class="form-control mb-4 col-4">
			<input type="number" th:field="*{discount}" value="0" placeholder="discount" class="form-control mb-4 col-4">
			<button type="submit" class="btn btn-info col-2"> Save Item</button>

		</form>
		<hr>
		<table border="1" class = "table table-striped table-responsive-md">
			<thead>
			<tr>
				<th>
					<a th:href="@{'/page/' + ${currentPage} + '?sortField=firstName&sortDir=' + ${reverseSortDir}}">
						Title</a>
				</th>
				<th>
					<a th:href="@{'/page/' + ${currentPage} + '?sortField=lastName&sortDir=' + ${reverseSortDir}}">
						Price</a>
				</th>
				<th style="width: 700px">
					<a th:href="@{'/page/' + ${currentPage} + '?sortField=firstName&sortDir=' + ${reverseSortDir}}">
						Quantity & Discount</a>
				</th>
<!--				<th>-->
<!--					<a th:href="@{'/page/' + ${currentPage} + '?sortField=firstName&sortDir=' + ${reverseSortDir}}">-->
<!--						Discount</a>-->
<!--				</th>-->
<!--				<th> Actions </th>-->
			</tr>

			</tr>
			</thead>
			<tbody>

			<tr th:each="item : ${listItem}">
			<td th:text="${item.name}"></td>
			<td th:text="${item.price}"></td>
				<td>
			<form id="add" style="float:left;display: flex; flex-direction: row;flex: 50px;" th:action="@{/addItemToInvoivce/invoiceId/{idInvoice}/itemId/{idItem}(idInvoice=${invoice.id},idItem=${item.id})}">

				<input type="number" style="margin-right: 5px;width: 30px" name="quantity1" id="quantity1" placeholder="quantity" th:value="${quantity1}" class="form-control mb-4 col-4">
			    <input type="number" style="margin-right: 5px;width: 30px" name="discount1" id="discount1" placeholder="discount" th:value="${discount1}" class="form-control mb-4 col-4">
				<input type="submit" value="Add item to invoice" style="margin-right: 5px;height: fit-content;width:550px" class="btn btn-info" />

<!--				<button form="add" style="margin-right: 5px;height: fit-content;width:550px" type="submit" class="btn btn-info col-2">Add item to invoice</button>-->
			</form></td>
				<script>
					var quantity = document.getElementById("quantity").value;
					var discount = document.getElementById("discount").value;
					var strLink ="/addItemToInvoivce/invoiceId/"+${invoice.id}+"/idItem/"+${item.id}+"/quantity/" + quantity+"/discount/"+discount;

				</script>
<!--			<td>-->
<!--				<button form="add" type="submit">Add item to invoice</button>-->
<!--&lt;!&ndash;				<a  th:href="@{/addItemToInvoivce/invoiceId/${invoice.id}/idItem/${item.id}/quantity/${quantity}/discount/${discount}}" class="btn" style="color:white;background-color: limegreen">Add item to invoice</a>&ndash;&gt;-->
<!--&lt;!&ndash;				<a  th:href="@{/addItemToInvoivce/invoiceId/${invoice.id}/idItem/${item.id}}" class="btn" style="color:white;background-color: limegreen">Add item to invoice</a>&ndash;&gt;-->

<!--			</td>-->
<!--				<td><a id="link" class="btn" style="color:white;background-color: limegreen">Add item to invoice</a></td>-->

				<!--				<td> <a th:href="@{/updateCustomer/{id}(id=${item.id})}" class="btn btn-primary">Update</a>-->
				<!--					<a th:href="@{/deleteCustomer/{id}(id=${item.id})}" class="btn btn-danger">Delete</a>-->
			</tr>

			</tbody>
		</table>
	</div>



</body>
</html>